<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="UTF-8" />
    <link rel="icon" href="https://raw.githubusercontent.com/mortim/vscode-noc/master/assets/icon.png" />
    <title>Noc documentation</title>
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu&display=swap">
    <style>
         * {
            padding: 0;
            font-family: 'Ubuntu', sans-serif;
            font-weight: 400;
        }
        
        body {
            background-color: ligthgrey;
        }

        h1, h2, h3, h4, h5, h6 {
            font-weight: 600;
        }

        pre, code {
            background-color: #E5E5CB;
            white-space: pre-wrap;
        }

        blockquote p {
            color: grey;
            font-style: italic;
        }

        table, th, td {
            border: 1px solid black;
        }

        li {
            list-style: none;
            word-break: break-all;
            margin-top: 13px;
        }

        li a {
            text-decoration: none;
            color: rgb(63, 63, 63);
            padding: 2px;
            border-radius: 5px;
        }

        li a:hover {
            color: rgb(83, 83, 83);
        }

        #table-of-contents {
            border: 1px solid lightgrey;
            margin-top: -1px;
        }

        #docs {
            padding-left: 20px;
            width: 100%;
        }

        #docs div {
            border: 1px solid lightgrey;
            padding-left: 10px;
            padding-bottom: 15px;
            background-color: #efe9e9;
            border-radius: 10px;
        }
        
        #top-btn {
            position: fixed;
            left: 90%;
            top: 80%;
            background-color: #008CBA;
            padding: 15px;
            color: #fff;
            text-decoration: none;
            border-radius: 5px;
        }

        h6 {
            color: grey;
        }

        #sidebar {
            width: 240px;
        }

        #sidebar2 {
            border: 1px solid lightgrey;
        }

        #sidebar ul {
            border-radius: 10px;
            padding: 0px 20px 20px;
        }

        #container {
            display:flex;
        }

        .section-title {
            text-align: center;
        }

        .more-link {
            background-color: lightblue;
            padding: 5px;
            border-radius: 5px;
            cursor: pointer;
            display:none;
        }

        input[type=checkbox] {
            display:none;
        }

        @media (max-width: 700px) {
            #container {
                display: block;
            }

            #docs {
                padding-left: 0px;
            }

            #docs * {
                word-break: break-all;
            }

            #top-btn {
                left: 80%;
            }

            .more-link {
                display:block;
            }

            #sidebar {
                width: 100%;
                text-align: center;
            }

            #table-of-contents li {
                display:none;
            }

            #table-of-contents li:nth-child(2), #table-of-contents li:nth-child(3), #table-of-contents li:nth-child(4), #table-of-contents li:last-child {
                display: block;
            }

            #sidebar2 li {
                display:none;
            }

            #sidebar2 li:nth-child(2), #sidebar2 li:nth-child(3), #sidebar2 li:nth-child(4), #sidebar2 li:last-child {
                display: block;
            }
        }
    </style>
</head>
<body>
    <h6 id="start-of-page">Documentation powered by <a href="https://github.com/noc-lang/nocdoc">nocdoc</a></h1>
    <h2>wiki : optimizations</h2>
    <div>
        <a id="top-btn" href="#start-of-page">Top</a>

        <div id="container">

            <div id="sidebar">
                <ul id="table-of-contents">
                <h3 class="section-title">Table of contents</h6>
                <li>Overview<ul><li><a href="index.html">index</a></li><li><a href="noc-wiki.html">noc-wiki</a></li></ul></li><li>Introduction<ul><li><a href="concatenative-programming.html">concatenative-programming</a></li></ul></li><li>Getting Started<ul><li><a href="installation.html">installation</a></li><li><a href="hello-world.html">hello-world</a></li></ul></li><li>Basics<ul><li><a href="expressions.html">expressions</a></li><li><a href="datatypes.html">datatypes</a></li><li><a href="functions.html">functions</a></li><li><a href="comments.html">comments</a></li></ul></li><li>Advanced Topic<ul><li><a href="docstring.html">docstring</a></li><li><a href="modules.html">modules</a></li><li><a href="quotes.html">quotes</a></li><li><a href="control-flow.html">control-flow</a></li><li><a href="optimizations.html">optimizations</a></li></ul></li><li>Reference<ul><li><a href="opcodes-prelude-v0.1.0.0.html">opcodes-prelude-v0.1.0.0</a></li><li><a href="primitives.html">primitives</a></li></ul></li>
                <li class="more-link" id="btn-1">
                    <label for="check-1">more</label>
                    <input type="checkbox" id="check-1" />
                </li>
                </ul>

                <ul id="sidebar2">
                
                <li class="more-link" id="btn-2">
                    <label for="check-2">more</label>
                    <input type="checkbox" id="check-2" />
                </li>
                </ul>
            </div>
            
            <div id="docs"> 
            <p>In the latest version, Noc runs in a virtual machine written in C, this feature was implemented in order to earn performances, reduce time execution.</p>

<p>Here is the Noc codebase:</p>

<ul>
<li><a href="https://github.com/noc-lang/noc/blob/master/app/Command/CLI.hs">CLI</a> (written in Haskell)</li>

<li><a href="https://github.com/noc-lang/noc/blob/master/src/Language/Noc/Syntax/AST.hs">Parser</a>/<a href="https://github.com/noc-lang/noc/blob/master/src/Language/Noc/Syntax/Lexer.hs">Lexer</a> (written in Haskell)</li>

<li>Pre-compilation (written in Haskell)


<ul>
<li><a href="https://github.com/noc-lang/noc/blob/master/src/Language/Noc/Resolution/Imports.hs">Name Resolution</a></li></ul>
</li>

<li>Compiler (written in Haskell)


<ul>
<li><a href="https://github.com/noc-lang/noc/blob/master/src/Language/Noc/Compiler/Bytecode.hs">Bytecode</a></li>

<li><a href="https://github.com/noc-lang/noc/blob/master/src/Language/Noc/Compiler/Serialize.hs">Serializer</a></li></ul>
</li>

<li><a href="https://github.com/noc-lang/noc/tree/master/src/Language/Noc/VM">Virtual Machine</a> (written in C)</li>
</ul>

<hr />

<p>Noc generates a bytecode, an intermediate representation much easier to read for the VM.</p>

<p>Bytecode structure: <code>Bytecode {sym = [], constant = [], doc = [], opcodes = []}</code></p>

<p><code>sym</code> => The Noc symbols (primitive functions, noc functions, opcodes (for the quote => it used to push opcode like a symbol in a quote))</p>

<p><code>constant</code> => All Noc values</p>

<p><code>doc</code> => All Noc functions docstrings</p>

<blockquote>
  <p>The fields above are used to earn time in storing essential datas like (constants, call functions) in indexing her thanks to the operand in some opcodes <code>PUSH_CONST index_const_table</code> for example. With this tables, we can avoid the use of hashtables that have usually O(n) time complexity against the indexing that have O(1) in complexity.</p>
</blockquote>

<p><code>opcodes</code> => The Noc program represented with a set of instructions named opcodes</p>

<blockquote>
  <p>The opcodes are linearly represented to avoid trees-recursion and execute each instructions with a basic for loop. A simple loop is much quicker.</p>
</blockquote>

<p>Example:</p>

<pre><code class="scala language-scala">def main = {
    5 5 + print
}
</code></pre>

<p>Bytecode output:</p>

<pre><code class="hs language-hs">Bytecode {
sym = [FuncSym "main" 0,OpcodeSym ADD_OP,FuncPrim "print" 10], 
constant = [IntConst 5], 
doc = [], 
opcodes = [PUSH_CONST 0,PUSH_CONST 0,ADD_OP,CALL_SYMBOL 2,RETURN]}
</code></pre>

<p>Then, this bytecode is serialized in a file in order to read this bytecode in the VM (written C) in deserializing her.</p>
            </div>
        </div>
    </div>

    <script>
        function toggleMenu(button, menu, checkbox) {
            button.addEventListener("click", () => {
                for(let i = 3; i < menu.length-1; i++) {
                    if(checkbox.checked) {
                        menu[i].style.display = "block";
                    } else {
                        menu[i].style.display = "none";
                    }
                }
            });
        }
    
        let buttons = document.querySelectorAll(".more-link");
        let menu1 = document.querySelectorAll("#table-of-contents li");
        let menu2 = document.querySelectorAll("#sidebar2 li");
        let checkboxes = document.querySelectorAll("input[type=checkbox]");

        toggleMenu(buttons[0], menu1, checkboxes[0]);
        toggleMenu(buttons[1], menu2, checkboxes[1]);
    </script>
</body>
</html>
    